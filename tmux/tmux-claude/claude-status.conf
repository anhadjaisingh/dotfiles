# tmux-claude-status configuration
# Shows per-window indicator when Claude Code is waiting for input

# Style option: "white" or "magenta" for the waiting indicator
set-option -g @claude-status-style "white"

# Define colors based on style
# Waiting: black bg + bright fg + filled dot
# Busy: default + grey hollow dot

# Window status format (non-current windows)
set-option -g window-status-format '\
#{?#{==:#{@claude-status},waiting},\
#[bg=black]#{?#{==:#{@claude-status-style},magenta},#[fg=magenta],#[fg=brightwhite]}#I:#W ●#[default],\
#{?#{==:#{@claude-status},busy},\
#[fg=colour244]#I:#W ○#[default],\
#I:#W}}'

# Current window format (highlighted)
set-option -g window-status-current-format '\
#{?#{==:#{@claude-status},waiting},\
#[bg=black]#{?#{==:#{@claude-status-style},magenta},#[fg=magenta],#[fg=brightwhite]}#[bold]#I:#W ●#[default],\
#{?#{==:#{@claude-status},busy},\
#[fg=colour244]#[bold]#I:#W ○#[default],\
#[bold]#I:#W}}'

# Start the polling script when tmux server starts
# The script handles its own duplicate prevention
run-shell -b '~/.tmux/tmux-claude/claude-status.sh &'

# Binding to toggle style between white and magenta
bind-key C-c run-shell '\
    current=$(tmux show-option -gv @claude-status-style 2>/dev/null || echo "white"); \
    if [ "$current" = "white" ]; then \
        tmux set-option -g @claude-status-style "magenta"; \
        tmux display-message "Claude status style: magenta"; \
    else \
        tmux set-option -g @claude-status-style "white"; \
        tmux display-message "Claude status style: white"; \
    fi'

# Binding to manually restart the status script
bind-key M-c run-shell '\
    pkill -f "claude-status.sh" 2>/dev/null; \
    ~/.tmux/tmux-claude/claude-status.sh & \
    tmux display-message "Claude status monitor restarted"'
